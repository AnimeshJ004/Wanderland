  <%- layout("/layouts/boilerplate") %>
   <div id="banner" style="margin: 2rem 0; padding: 3rem 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); position: relative; overflow: hidden; color: white; text-align: center;">
     <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80') center/cover; opacity: 0.3; z-index: 1;"></div>
     <div style="position: relative; z-index: 2;">
       <i class="fas fa-compass" style="font-size: 3rem; margin-bottom: 1rem; color: #ffd93d;"></i>
       <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Discover Your Next Adventure</h1>
       <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.9;">Explore breathtaking destinations and create unforgettable memories</p>
       <a href="/listings/new" class="btn btn-light btn-lg" style="border-radius: 25px; padding: 0.75rem 2rem; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s ease;">
         <i class="fas fa-plus-circle me-2"></i>Start Your Journey
       </a>
     </div>
   </div>

   <style>
    .filter {
      padding: 1.5rem 1.75rem !important;
    }
    .filter:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15) !important;
    }
    .filter:hover div:first-child {
      transform: scale(1.1);
    }
    .tax-toggle-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(254, 66, 77, 0.4);
    }
    .tax-toggle-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(254, 66, 77, 0.3);
    }

    /* Neumorphic Card Styles */
    .neumorphic-card {
      background: linear-gradient(145deg, #f0f4f8, #e1e9f0);
      box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
      transition: all 0.4s ease;
      border-radius: 16px;
    }
    .neumorphic-card:hover {
      box-shadow: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff;
      transform: translateY(-2px);
    }
    .neumorphic-card:hover .card-img-top {
      transform: scale(1.02);
    }
    .neumorphic-card .card-img-overlay button:hover {
      transform: scale(1.1);
      box-shadow: inset 2px 2px 4px #d1d9e6, inset -2px -2px 4px #ffffff;
    }

    /* Card Style Variations */
    .card-style-1 {
      box-shadow: 8px 8px 16px #c8d0e7, -8px -8px 16px #ffffff, 0 0 0 1px rgba(0,123,255,0.1);
    }
    .card-style-1:hover {
      box-shadow: inset 4px 4px 8px #c8d0e7, inset -4px -4px 8px #ffffff, 0 0 0 1px rgba(0,123,255,0.2);
    }
    .card-style-2 {
      box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff, 0 0 0 1px rgba(40,167,69,0.1);
    }
    .card-style-2:hover {
      box-shadow: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff, 0 0 0 1px rgba(40,167,69,0.2);
    }
    .card-style-3 {
      box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff, 0 0 0 1px rgba(255,193,7,0.1);
    }
    .card-style-3:hover {
      box-shadow: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff, 0 0 0 1px rgba(255,193,7,0.2);
    }

    .features-row .feature-item {
      transition: transform 0.2s ease;
    }
    .features-row .feature-item:hover {
      transform: translateY(-2px);
    }

    .rating-stars {
      display: flex;
      align-items: center;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    }

    /* Favorite button hover effect */
    .neumorphic-card:hover .favorite-overlay {
      opacity: 1;
    }

    /* Heartbeat animation for click effect */
    @keyframes heartBeat {
      0%, 50%, 100% { transform: scale(1); }
      25%, 75% { transform: scale(1.15); }
    }

    .favorite-btn.clicked {
      animation: heartBeat 0.5s ease-in-out !important;
    }

    /* Enhanced favorite button styling */
    .favorite-btn {
      border: none !important;
      width: 30px !important;
      height: 30px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
      cursor: pointer !important;
      border-radius: 50% !important;
      /* background: rgba(255, 255, 255, 0.9) !important; */
      /* backdrop-filter: blur(10px) !important; */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      position: relative !important;
      overflow: hidden !important;
    }

    .favorite-btn::before {
      content: '' !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important;
      border-radius: 50% !important;
      opacity: 0 !important;
      transition: opacity 0.3s ease !important;
    }

    .favorite-btn:hover {
      transform: translateY(2px) !important;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 0 20px rgba(220, 53, 69, 0.2) !important;
      background: rgba(255, 255, 255, 0.95) !important;
    }

    .favorite-btn:hover::before {
      opacity: 1 !important;
    }

    .favorite-btn.favorited {
      background: linear-gradient(135deg, #ff4757, #ff3838) !important;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4), 0 0 20px rgba(255, 71, 87, 0.2) !important;
      animation: pulse 2s infinite !important;
    }

    .favorite-btn.favorited:hover {
      background: linear-gradient(135deg, #ff3742, #ff2828) !important;  
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.6), 0 0 30px rgba(255, 71, 87, 0.4) !important;
      transform: scale(1.15) translateY(-3px) !important;
    }

    .favorite-btn.favorited::before {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1)) !important;
    }

    .favorite-btn i {
      /* transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important; */
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.2)) !important;
      font-size: 1rem !important;
      position: relative !important;
      z-index: 1 !important;
    }

    .favorite-btn:hover i {
      transform: scale(1.3) !important;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3)) !important;
    }

    .favorite-btn.favorited i {
      color: white !important;
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)) !important;
    }

    .favorite-btn.favorited:hover i {
      transform: scale(1) !important;
      filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.8)) !important;
    }

    /* Pulse animation for favorited state */
    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4), 0 0 20px rgba(255, 71, 87, 0.2);
      }
      50% {
        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.6), 0 0 25px rgba(255, 71, 87, 0.3);
      }
    }

    /* Always show favorite button on mobile (no hover needed) */
    @media (max-width: 768px) {
      .favorite-overlay {
        opacity: 1 !important;
      }
      .neumorphic-card {
        margin-bottom: 1.5rem;
      }
      .features-row {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .features-row .feature-item {
        flex: 1 1 45%;
        min-width: 80px;
      }
    }
   </style>

   <script>
    let taxBtn = document.getElementById('tax-toggle-btn');
    let taxText = document.getElementById('tax-toggle-text');
    let isTaxesShown = false;

    taxBtn.addEventListener('click', () => {
      let taxinfo = document.getElementsByClassName('tax-info');
      for (let info of taxinfo) {
        if (isTaxesShown) {
          info.style.display = 'none';
          taxText.textContent = 'Show Taxes';
        } else {
          info.style.display = 'inline';
          taxText.textContent = 'Hide Taxes';
        }
      }
      isTaxesShown = !isTaxesShown;
    });

    // Favorite button AJAX functionality
    document.addEventListener('DOMContentLoaded', () => {
      const favoriteBtns = document.querySelectorAll('.favorite-btn');
      favoriteBtns.forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          e.stopPropagation();
          const form = btn.closest('.favorite-form');
          const listingId = btn.getAttribute('data-listing-id');
          const isFavorited = btn.getAttribute('data-is-favorited') === 'true';
          const action = isFavorited ? 'remove' : 'add';

          try {
            const response = await fetch(`/favorites/${listingId}/${action}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
              },
            });

            if (response.ok) {
              btn.classList.toggle('favorited');
              btn.setAttribute('data-is-favorited', !isFavorited);
              // Update form action
              const newAction = !isFavorited ? 'remove' : 'add';
              form.action = `/favorites/${listingId}/${newAction}`;
              // Update icon color
              const icon = btn.querySelector('i');
              icon.classList.remove('text-danger', 'text-muted');
              if (!isFavorited) {
                icon.classList.add('text-danger');
              } else {
                icon.classList.add('text-muted');
              }
              // Add heartbeat animation
              btn.classList.add('clicked');
              setTimeout(() => {
                btn.classList.remove('clicked');
              }, 500);
            } else {
              console.error('Failed to toggle favorite');
            }
          } catch (error) {
            console.error('Error:', error);
          }
        });
      });
    });
   </script>

   <div class="container mt-4 mb-5">
     <h2 class="mb-4 text-center" style="color: #333; font-weight: 700;">All Listings</h2>
     <% if (listings.length === 0) { %>
       <div class="text-center mt-5">
         <i class="fas fa-search fa-3x text-muted mb-3"></i>
         <h4 class="text-muted">No listings found</h4>
         <p class="text-muted">Be the first to create a listing!</p>
         <a href="/listings/new" class="btn btn-primary btn-lg">Create New Listing</a>
       </div>
     <% } else { %>
       <div class="row">
         <% listings.forEach((listing, index) => { %>
           <% const cardStyles = ['card-style-1', 'card-style-2', 'card-style-3']; %>
           <% const cardStyle = cardStyles[index % cardStyles.length]; %>
           <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
             <div class="card neumorphic-card <%= cardStyle %> h-100" style="border: none; border-radius: 16px; overflow: hidden; transition: all 0.4s ease; position: relative;">
               <div class="position-relative" style="height: 250px;">
                 <img src="<%= listing.image.url %>" class="card-img-top" alt="<%= listing.title %>" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease;">
                 <div class="favorite-overlay" style="position: absolute; top: 10px; right: 10px; opacity: 1; transition: opacity 0.3s ease;">
                   <% if(currentUser) { %>
                     <%
                       const isFavorited = currentUser.favorites && currentUser.favorites.some(fav => fav.toString() === listing._id.toString());
                     %>
                     <form action="/favorites/<%= listing._id %>/<%= isFavorited ? 'remove' : 'add' %>" method="POST" class="favorite-form">
                       <button type="submit" class="btn btn-sm favorite-btn <%= isFavorited ? 'favorited' : '' %>" data-listing-id="<%= listing._id %>" data-is-favorited="<%= isFavorited %>">
                         <i class="fas fa-heart <%= isFavorited ? '' : 'text-muted' %>"></i>
                       </button>
                     </form>
                   <% } %>
                 </div>
               </div>

               <div class="card-body" style="padding: 1.8rem; line-height: 1.6;">
                 <div class="d-flex justify-content-between align-items-start mb-4">
                   <h6 class="card-title mb-0" style="font-weight: 700; font-size: 1.2rem; line-height: 1.4; color: #1a202c; margin-bottom: 0.6rem; margin-left: 1rem; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"><%= listing.title %></h6>
                   <div class="price-section text-end me-3">
                     <span class="price-main fw-bold text-primary" style="font-size: 1.3rem; display: flex; font-weight: 800;">â‚¹<%= listing.price.toLocaleString("en-IN") %></span>
                     <div class="price-sub text-muted" style="font-size: 0.75rem; margin-top: 0.3rem; font-weight: 500;">per night</div>
                     <span class="tax-info text-muted ms-1" style="display: none; font-size: 0.8rem; font-weight: 500;">+18% GST</span>
                   </div>
                 </div>

                 <p class="card-text text-muted mb-4" style="font-size: 0.95rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 1.2rem; margin-left: 1rem; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"><%= listing.description %></p>

               </div>

               <div class="card-footer" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-top: 1px solid rgba(0,0,0,0.1); padding: 1rem 1.8rem; border-radius: 0 0 16px 16px;">
                 <div class="d-flex align-items-center mb-3">
                   <i class="fas fa-map-marker-alt text-danger me-2" style="font-size: 0.9rem;"></i>
                   <small class="text-muted fw-medium" style="font-size: 0.85rem; font-weight: 500;"><%= listing.location %>, <%= listing.country %></small>
                 </div>
                 <a href="/listings/<%= listing._id %>" class="btn btn-primary btn-sm" style="border-radius: 8px; width: 100%; padding: 0.6rem 1rem; font-weight: 600; font-size: 0.85rem; transition: all 0.3s ease;">View Details</a>
               </div>
             </div>
           </div>
         <% }); %>
       </div>
     <% } %>
   </div>
